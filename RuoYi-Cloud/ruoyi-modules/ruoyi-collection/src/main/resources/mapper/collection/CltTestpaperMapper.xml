<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.collection.mapper.CltTestpaperMapper">
  <resultMap type="CltTestpaper" id="CltTestpaperResult">
    <result property="testpaperId" column="testpaper_id"/>
    <result property="examId" column="exam_id"/>
    <result property="testpaperName" column="testpaper_name"/>
    <result property="testpaperType" column="testpaper_type"/>
    <result property="subjectCode" column="subject_code"/>
    <result property="fullscore" column="fullscore"/>
    <result property="hasItem" column="has_item"/>
    <result property="hasCj" column="has_cj"/>
    <result property="orderNum" column="order_num"/>
    <result property="remark" column="remark"/>
    <result property="status" column="status"/>
    <result property="delFlag" column="del_flag"/>
    <result property="createBy" column="create_by"/>
    <result property="createTime" column="create_time"/>
    <result property="updateBy" column="update_by"/>
    <result property="updateTime" column="update_time"/>
  </resultMap>

  <sql id="selectCltTestpaperVo">
        select
            testpaper_id, exam_id, testpaper_name, testpaper_type,
            subject_code, fullscore, has_item, has_cj, order_num, remark,
            status, del_flag, create_by, create_time, update_by, update_time
        from
            clt_testpaper
    </sql>
  <select id="selectCltTestpaperList" parameterType="CltTestpaper" resultMap="CltTestpaperResult">
    <include refid="selectCltTestpaperVo"/>
    <where>
      <if test="examId != null ">and exam_id = #{examId}
      </if>
      <if test="testpaperName != null  and testpaperName != ''">and testpaper_name like concat('%',
        #{testpaperName}, '%')
      </if>
      <if test="testpaperType != null  and testpaperType != ''">and testpaper_type =
        #{testpaperType}
      </if>
    </where>
    order by order_num
  </select>

  <delete id="deleteTestpaperByexamId">
    DELETE FROM `clt_testpaper` where exam_id=${examId};
  </delete>

  <insert id="copyTestPaperToProject">
    INSERT INTO  aly_testpaper(project_id,testpaper_id,aly_testpaper_name,subject_code,aly_subject_come,aly_subject_type,fullscore,order_num ,create_time)
    SELECT #{projectId} project_id,testpaper_id,testpaper_name aly_testpaper_name,subject_code,'0' aly_subject_come,'single' aly_subject_type,fullscore,order_num, NOW() create_time
     FROM clt_testpaper WHERE exam_id=#{examId}
  </insert>

</mapper>
